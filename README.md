This is copied from /weakening_compensation/analysis/